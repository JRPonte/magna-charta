/*! Magna Charta - v0.1.0 - 2012-11-09
* https://github.com/alphagov/magna-charta
 */
(function(b){var a=function(){this.init=function(d,c){var e={outOf:95,applyOnInit:true};this.options=b.extend({},e,c);this.$table=d;this.$bodyRows=this.$table.find("tr");if(this.options.applyOnInit){this.apply()}return this};this.apply=function(){this.addClasses();this.applyWidths()};this.revert=function(){this.removeWidths();this.removeClasses()};this.removeClasses=function(){this.$table.removeClass("mc-table").find(".mc-key-cell, .mc-row, .mc-bar-cell").removeClass("mc-key-cell mc-row mc-bar-cell")};this.removeWidths=function(){this.$table.find(".mc-bar-cell").css("width","")};this.utils={isFloat:function(c){return !isNaN(parseFloat(c))},stripValue:function(c){return c.replace("%","").replace("Â£","").replace("m","")},returnMax:function(d){var c=0;for(var e=0;e<d.length;e++){if(d[e]>c){c=d[e]}}return c}};this.addClasses=function(){this.$bodyRows.addClass("mc-row");this.$table.addClass("mc-table")};this.calculateMaxWidth=function(){var d=this;var e={max:0,single:0};var c=[];this.$bodyRows.each(function(g,k){var l=b(k);var j=l.find("td:not(:first)");var h=l.find("th:not(:first, .total)").addClass("mc-key-cell");l.find("td:first").addClass("mc-key-cell");var f=0;j.each(function(m,i){var o=b(i).addClass("mc-bar-cell");var n=d.utils.stripValue(o.text());if(d.utils.isFloat(n)){f+=parseFloat(n,10)}});c.push(f);e.max=parseFloat(d.utils.returnMax(c),10)});e.single=parseFloat(this.options.outOf/e.max,10);return e};this.applyWidths=function(){this.dimensions=this.calculateMaxWidth();var c=this;this.$bodyRows.each(function(d,f){var e=b(f);e.find("td:not(:first)").each(function(h,g){var i=parseFloat(c.utils.stripValue(b(g).text()),10)*c.dimensions.single;b(g).css({width:i+"%"})})})}};b.magnaCharta=function(d,c){return new a().init(d,c)}}(jQuery));